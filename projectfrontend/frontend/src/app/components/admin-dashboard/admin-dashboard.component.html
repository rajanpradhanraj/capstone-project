<div class="admin-dashboard">
  <div class="dashboard-header">
    <h2>Dashboard</h2>
    <button mat-raised-button color="primary" (click)="loadDashboardData()">
      <mat-icon>refresh</mat-icon>
      Refresh
    </button>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="loading-section">
    <mat-spinner></mat-spinner>
    <p>Loading dashboard data...</p>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading">
    <!-- Summary Cards -->
    <div class="summary-cards">
      <mat-card class="stat-card products-card">
        <mat-card-content>
          <div class="stat-content">
            <div class="stat-icon"><mat-icon>inventory</mat-icon></div>
            <div class="stat-info">
              <div class="stat-number">{{ dashboardData.total_products }}</div>
              <div class="stat-label">Total Products</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card orders-card">
        <mat-card-content>
          <div class="stat-content">
            <div class="stat-icon"><mat-icon>receipt_long</mat-icon></div>
            <div class="stat-info">
              <div class="stat-number">{{ dashboardData.total_orders }}</div>
              <div class="stat-label">Total Orders</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card revenue-card">
        <mat-card-content>
          <div class="stat-content">
            <div class="stat-icon"><mat-icon>attach_money</mat-icon></div>
            <div class="stat-info">
              <div class="stat-number">â‚¹{{ dashboardData.total_revenue.toFixed(2) }}</div>
              <div class="stat-label">Total Revenue</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card stock-card">
        <mat-card-content>
          <div class="stat-content">
            <div class="stat-icon"><mat-icon>warning</mat-icon></div>
            <div class="stat-info">
              <div class="stat-number">{{ dashboardData.low_stock_products }}</div>
              <div class="stat-label">Low Stock Items</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Charts Row -->
    <div class="charts-row">
      <!-- Order Status Breakdown -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Order Status Breakdown</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="status-breakdown">
            <div *ngFor="let status of getOrderStatusKeys()" class="status-item">
              <div class="status-info">
                <span class="status-badge" [ngClass]="getStatusClass(status)">
                  {{ status | titlecase }}
                </span>
                <span class="status-count">{{ dashboardData.order_status_counts[status] }}</span>
              </div>
              <div class="status-bar">
                <div class="status-progress" 
                     [style.width.%]="(dashboardData.order_status_counts[status] / dashboardData.total_orders) * 100"
                     [ngClass]="getStatusClass(status)">
                </div>
              </div>
            </div>
          </div>
          <div *ngIf="getOrderStatusKeys().length === 0" class="empty-message">
            No orders found
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Low Stock Items -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Low Stock Alert</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="low-stock-list">
            <div *ngFor="let item of dashboardData.low_stock_items" class="stock-item">
              <div class="item-info">
                <div class="item-name">{{ item.name }}</div>
                <div class="item-category">{{ item.category }}</div>
              </div>
              <div class="stock-level">
                <span class="stock-number" 
                      [class.critical]="item.stock < 5"
                      [class.warning]="item.stock >= 5 && item.stock < 10">
                  {{ item.stock }} left
                </span>
              </div>
            </div>
          </div>
          <div *ngIf="dashboardData.low_stock_items.length === 0" class="empty-message">
            All products are well stocked!
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Recent Orders -->
    <mat-card class="recent-orders-card">
      <mat-card-header>
        <mat-card-title>Recent Orders</mat-card-title>
        <div class="spacer"></div>
        <button mat-button routerLink="/admin/orders">
          View All Orders <mat-icon>arrow_forward</mat-icon>
        </button>
      </mat-card-header>
      <mat-card-content>
        <div class="orders-table">
          <table>
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Date</th>
                <th>Customer</th>
                <th>Total</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let order of dashboardData.recent_orders">
                <td><strong>#{{ order.id }}</strong></td>
                <td>{{ order.created_at | date:'short' }}</td>
                <td>{{ order.user_id }}</td>
                <td class="text-success">${{ order.total_amount.toFixed(2) }}</td>
                <td>
                  <span class="status-badge" [ngClass]="getStatusClass(order.status)">
                    {{ order.status | titlecase }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div *ngIf="dashboardData.recent_orders.length === 0" class="empty-message">
          No recent orders found
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>

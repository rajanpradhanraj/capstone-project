<div class="cart-container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Shopping Cart</h2>
    <button mat-stroked-button (click)="continueShopping()">
      <mat-icon>arrow_back</mat-icon>
      Continue Shopping
    </button>
  </div>

  <!-- Empty Cart -->
  <div *ngIf="cart.items.length === 0" class="empty-cart text-center py-5">
    <mat-icon class="large-icon text-muted">shopping_cart</mat-icon>
    <h4 class="mt-3">Your cart is empty</h4>
    <p class="text-muted">Add some products to get started</p>
    <button mat-raised-button color="primary" (click)="continueShopping()">
      <mat-icon>store</mat-icon>
      Browse Products
    </button>
  </div>

  <!-- Cart Items -->
  <div *ngIf="cart.items.length > 0">
    <div class="row">
      <!-- Cart Items List -->
      <div class="col-lg-8">
        <mat-card class="cart-items-card">
          <mat-card-header>
            <mat-card-title>Cart Items ({{ cart.item_count }})</mat-card-title>
            <div class="spacer"></div>
            <button mat-button color="warn" (click)="clearCart()" [disabled]="loading">
              <mat-icon>clear_all</mat-icon>
              Clear Cart
            </button>
          </mat-card-header>

          <mat-card-content>
            <div class="cart-item" *ngFor="let item of cart.items; trackBy: trackByProductId">
              <div class="row align-items-center">
                <!-- Product Image -->
                <div class="col-md-2">
                  <img [src]="item.product_image || 'https://via.placeholder.com/100x100'" 
                       [alt]="item.product_name" class="item-image">
                </div>

                <!-- Product Details -->
                <div class="col-md-4">
                  <h6 class="item-name">{{ item.product_name }}</h6>
                  <p class="item-price">₹{{ item.product_price }}</p>
                  <small class="text-muted">{{ item.available_stock }} available</small>
                </div>

                <!-- Quantity Controls -->
                <div class="col-md-3">
                  <div class="quantity-controls">
                    <button mat-icon-button 
                            (click)="updateQuantity(item, item.quantity - 1)"
                            [disabled]="updating[item.product_id] || item.quantity <= 1">
                      <mat-icon>remove</mat-icon>
                    </button>
                    
                    <span class="quantity">{{ item.quantity }}</span>
                    
                    <button mat-icon-button 
                            (click)="updateQuantity(item, item.quantity + 1)"
                            [disabled]="updating[item.product_id] || item.quantity >= item.available_stock">
                      <mat-icon>add</mat-icon>
                    </button>
                  </div>
                  
                  <div *ngIf="updating[item.product_id]" class="text-center mt-2">
                    <mat-spinner diameter="20"></mat-spinner>
                  </div>
                </div>

                <!-- Subtotal -->
                <div class="col-md-2">
                  <div class="item-subtotal">₹{{ item.subtotal.toFixed(2) }}</div>
                </div>

                <!-- Remove Button -->
                <div class="col-md-1">
                  <button mat-icon-button color="warn" 
                          (click)="removeItem(item)"
                          [disabled]="updating[item.product_id]">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>

              <!-- Stock Warning -->
              <div *ngIf="item.quantity > item.available_stock" class="stock-warning mt-2">
                <mat-icon class="warning-icon">warning</mat-icon>
                Only {{ item.available_stock }} items available. Please adjust quantity.
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Order Summary -->
      <div class="col-lg-4">
        <mat-card class="summary-card sticky-top">
          <mat-card-header>
            <mat-card-title>Order Summary</mat-card-title>
          </mat-card-header>

          <mat-card-content>
            <div class="summary-row">
              <span>Items ({{ cart.item_count }}):</span>
              <span>₹{{ cart.total_amount.toFixed(2) }}</span>
            </div>

            <div class="summary-row">
              <span>Shipping:</span>
              <span class="text-success">FREE</span>
            </div>

            <mat-divider class="my-3"></mat-divider>

            <div class="summary-row total">
              <strong>Total: ₹{{ cart.total_amount.toFixed(2) }}</strong>
            </div>
          </mat-card-content>

          <mat-card-actions>
            <button mat-raised-button color="primary" 
                    (click)="proceedToCheckout()"
                    class="w-100 checkout-btn"
                    [disabled]="cart.items.length === 0">
              <mat-icon>payment</mat-icon>
              Proceed to Checkout
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
    </div>
  </div>
</div>

<style>
.cart-container {
  max-width: 1200px;
  margin: 0 auto;
}

.large-icon {
  font-size: 64px;
  width: 64px;
  height: 64px;
}

.cart-items-card {
  .mat-card-header {
    display: flex;
    align-items: center;
    
    .spacer {
      flex: 1;
    }
  }
}

.cart-item {
  padding: 16px 0;
  border-bottom: 1px solid #e0e0e0;
  
  &:last-child {
    border-bottom: none;
  }
}

.item-image {
  width: 80px;
  height: 80px;
  object-fit: cover;
  border-radius: 8px;
}

.item-name {
  font-weight: 600;
  margin-bottom: 4px;
}

.item-price {
  color: #4caf50;
  font-weight: 500;
  margin-bottom: 4px;
}

.quantity-controls {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  
  .quantity {
    min-width: 30px;
    text-align: center;
    font-weight: 500;
  }
}

.item-subtotal {
  font-size: 1.1rem;
  font-weight: 600;
  color: #4caf50;
  text-align: right;
}

.stock-warning {
  background: #fff3cd;
  border: 1px solid #ffeaa7;
  border-radius: 4px;
  padding: 8px;
  color: #856404;
  display: flex;
  align-items: center;
  gap: 8px;
  
  .warning-icon {
    color: #ff9800;
  }
}

.summary-card {
  .summary-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    
    &.total {
      font-size: 1.2rem;
      margin-bottom: 0;
    }
  }
  
  .checkout-btn {
    height: 48px;
    font-size: 1.1rem;
  }
}

.sticky-top {
  position: sticky;
  top: 20px;
}
</style>

